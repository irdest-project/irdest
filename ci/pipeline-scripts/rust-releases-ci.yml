# Script that triggers the pipelines for rust-components of `irdest`

bundle-ratman-x86_64:
  tags: [ irdest-nix ]
  stage: build
  needs: [ build-ratman-dashboard ]
  script:
    - nix-env -iA cachix -f https://cachix.org/api/v1/install
    - cachix use irdest -O ~/.config/nix
    - nix-build nix -A irdest-bundle -o ratman-bundle-x86_64
    - tar cvf ratman-bundle-x86_64.tar.gz ratman-bundle-x86_64/
  artifacts:
    paths:
      - ratman-bundle-x86_64.tar.gz


bundle-ratman-aarch64:
  tags: [ irdest-nix ]
  stage: build
  needs: [ build-ratman-dashboard ]
  script:
    - nix-env -iA cachix -f https://cachix.org/api/v1/install
    - cachix use irdest -O ~/.config/nix
    - nix-build nix -A pkgsCross.aarch64-multiplatform.irdest-bundle -o ratman-bundle-aarch64
    - tar cvf ratman-bundle-aarch64.tar.gz ratman-bundle-aarch64/
  artifacts:
    paths:
      - ratman-bundle-aarch64.tar.gz
