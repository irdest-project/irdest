# Script to trigger `.ipk` packaging for `irdest`

bundle-ratman-openwrt-ipk:
  tags: [ irdest-nix ]
  stage: bundle
  depdencies:
    - build-ratmand-static-armv7l-musl
  script:
    - mkdir ratman-openwrt-arm_cortex-a7_neon-vfpv4 && cd ratman-openwrt-arm_cortex-a7_neon-vfpv4
    - cp -rv ../dist/openwrt/ratmand .
    - mkdir -p usr/bin
    - cp -rv ../result-ratmand/bin usr/bin
    - tar cvf data.tar.gz usr
    - tar cvf control.tar.gz control postinst prerm
    - tar cvf ratman-openwrt-arm_cortex-a7_neon-vfpv4.ipk data.tar.gz control.tar.gz debian-binary
    - cd ..
    - mv ratman-openwrt-arm_cortex-a7_neon-vfpv4/ratman-openwrt-arm_cortex-a7_neon-vfpv4.ipk .
  artifacts:
    paths:
      - ratman-openwrt-arm_cortex-a7_neon-vfpv4.ipk